---
title: "P8105 Homework 5"
author: "Siyue Gao"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	fig.height = 6,
	out.width = "90%"
)
```

```{r}
library(tidyverse)
```

```{r, include = FALSE}
theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

Start with a dataframe containing all file names.

```{r}
file_names = list.files(path = "data/problem1", full.names = TRUE)
```

Iterate over file names and read in data for each subject using `purrr::map`. The results are saved as `files`.

```{r}
files = map(file_names, read_csv)

for (i in 1:20) {
  
  if (i < 11) {
    
    files[[i]] = files[[i]] %>% 
      mutate(
        subject_id = i,
        arm = "Control"
      )
    
  }
  
  else {
    
    files[[i]] = files[[i]] %>% 
      mutate(
        subject_id = i - 10,
        arm = "Experimental"
      )

  }
  
}
```

Tidy the result dataframe by `bind_rows()` and `pivot_longer()`.

```{r}
result_df = files %>% 
  bind_rows() %>% 
  select(subject_id, everything()) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "observation"
  ) %>% 
  mutate(
    subject_id = as.character(subject_id),
    week = as.numeric(week)
  )
```

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
result_df %>% 
  ggplot(aes(x = week, y = observation, type = subject_id, color = arm)) +
  geom_line() +
  labs(
    x = "Week",
    y = "Observation Values",
    color = "Arm",
    title = "Observations on each subject over time by study arm"
  )
```

On average, the observation values for those in experimental arm are higher than those in control arm. In addition, there seems to be some increasing over time in experimental arm, while the observation value tends to be more constant for those in control arm.


## Problem 2

Import the data.

```{r}
homicide = read_csv("data/homicide-data.csv")
```

The `homicide` dataset contains `r nrow(homicide)` cases, with `r ncol(homicide)` variables, mainly describing the homicide cases in `r n_distinct(homicide$city)` cities in U.S. These variables include reported date and location, some information on victim (name, race, age, and sex), and the final disposition of the homicide.